---
layout: post
title: Hotplugging a Secondary Display on Linux
date: '2007-09-23T13:52:00.000-05:00'
author: geekaholic
tags: 
modified_time: '2007-09-23T16:50:50.099-05:00'
thumbnail: http://farm2.static.flickr.com/1269/1430021546_6417ceaa02_t.jpg
blogger_id: tag:blogger.com,1999:blog-8947964.post-7802706408646164681
blogger_orig_url: https://www.geekaholic.org/2007/09/hotplugging-secondary-display-on-linux.html
---

GNU/Linux has been ready for the desktop for quite some time. And yet, when trying to tell the world about how ready Desktop Linux is, using a well prepared Open Office presentation, I am often faced with having to smile and say, oops looks like I need to restart  X windows before my computer [Linux] can detect the LCD projector.<br /><br />Lets face it, there are still some glitches here and there but the FOSS community is working hard at solving those problems, one by one. One such problem has been the inability to plug in an external display such as an external monitor or LCD projector and get it to "just work" without having to restart X Windows. That was until Xorg 7.3 came along!<br /><br />Ever since I heard of Xorg 7.3 a couple of months earlier, I waited eagerly. Xorg 7.3 was <a href="http://www.x.org/wiki/Releases/7.3">finally released</a> earlier this month. Unfortunately I was too busy to install it (i wanted to update other gentoo packages before I did this). Finally this weekend, I managed to upgrade my system (emerge -avuDN world) and get xorg 7.3 working!<br /><br />Before I get to the monitor plugging, I'd like to make few comments on my experience doing this on Gentoo. First off, after emerging X org 7.3, X didn't start at all! Turned out that the upgrade process didn't recompile some dependency packages because their version hadn't changed. These are pretty much Gentoo specific issues and your not going to have to worry about it on binary based distros.<br /><br />The other problem I had was with my <a href="http://en.wikipedia.org/wiki/Touchpad">synaptic touch pad</a> not working. While trying to figure that out, I remembered that xorg 7.3 is supposed to have INPUT hotplugging and work even without an xorg.conf configuration file. So I renamed /etc/X11/xorg.conf and restarted zapped X (Ctrl+Alt+BS), and everything worked beautifully -- sort of. The synaptic touchpad worked and everything seemed fine, except I was having problems with compiz-fusion, the 3D stuff. I could get the 3D cube to rotate and see the wobbly effect but was unable to see what I was typing in the terminal. I could also not see any icons on certain windows such as of <a href="http://wiki.opencompositing.org/CCSM">ccsm</a>. It took me about an hour to figure out this was actually a problem with using an auto detected xorg.conf. So in the end, I reverted back to the old xorg.conf and found how to get synaptic working on it (thanks to google of course). Here is how my synaptic configuration on xorg.conf now looks like:<br /><br /><code><br />Section "ServerLayout"<br />        Identifier     "X.org Configured"<br />        Screen      0  "Screen0" 0 0<br /><br />        #InputDevice    "TouchPad" "AlwaysCore"  # Old setting<br />        #InputDevice    "Mouse0" "CorePointer"   # Old setting<br />        InputDevice    "TouchPad" "CorePointer"  # New for xorg 7.3<br />        InputDevice    "Mouse0" "SendCoreEvents"<br /><br />        InputDevice    "Keyboard0" "CoreKeyboard"<br />        Option         "AIGLX" "true"<br />EndSection<br /><br />Section "InputDevice"<br />   Driver      "synaptics"<br />   Identifier  "TouchPad"<br />   Option      "SendCoreEvents"<br />   Option      "Protocol" "auto-dev"<br />   Option      "SHMConfig" "on"<br />EndSection<br /><br /></code><br />  <br />Anyway, so now for the good stuff! I plugged in my 17" monitor to the VGA out of the notebook and waited. The signal not detected sign went away and the screen was pitch black. It was on indefinitely on standby. I zapped X again to restart it and this time got a display on the monitor. Hmmm not the hotplug I had in mind. A bit disappointed I wanted to get to the bottom of this - I mean hotplugging was supposed to be the main feature.<br /><br />Turns out you can turn on a secondary display without restarting (zapping) X and here is how:<br /><br />Meet the updated version of <a href="http://en.wikipedia.org/wiki/XRandR">xrandr</a>. You should have xrandr 1.2 for this to work.<br /><br /><code><br /># xrandr -v<br />Server reports RandR version 1.2<br /></code><br /><br />To get a list of displays available along with its status issue:<br /><code><br /># xrandr -q<br />Screen 0: minimum 320 x 200, current 1280 x 800, maximum 2432 x 864<br />VGA connected (normal left inverted right x axis y axis)<br />   1152x864       74.8<br />   1024x768       84.9     75.1     70.1     60.0<br />   832x624        74.6<br />   800x600        99.7     84.9     72.2     75.0     60.3<br />   640x480        99.8     84.6     75.0     72.8     60.0<br />   720x400        70.1<br />   640x350        70.1<br />LVDS connected 1280x800+0+0 (normal left inverted right x axis y axis) 331mm x 207mm<br />   1280x800       60.0*+<br />   1024x768       60.0<br />   800x600        60.3<br />   640x480        59.9<br />TV disconnected (normal left inverted right x axis y axis)<br /></code><br /><br />The output of xrandr -q shows two devices, VGA which represents my VGA out and is also shown to be connected to the monitor and LVDS, my LCD display. A third TV out is shown but is unfortunately not physically available on my notebook model :(<br /><br />To enable my VGA out display and show an exact copy of whats on my LCD:<br /><code><br />xrandr --output VGA --auto<br /></code><br /><br />This should automatically pick out the preferred resolution for the monitor and enable it. Alternatively if you want to specify the resolution from one of the modes supported (as given by xrandr -q):<br /><code><br />xrandr --output VGA --mode 1024x768<br /></code><br /><br />You can turn off the external display by issuing<br /><code><br />xrandr --output VGA --off<br /></code><br /><br />If you want you can create a VGA out toggle script and assign it to a keyboard short cut.<br /><code><br /># vi ~/toggle-vga.sh<br />#!/bin/bash<br />XRANDR_OUT=`xrandr -q`<br />if echo "$XRANDR_OUT"|grep -q 'VGA connected'; then<br />        echo 'Detected VGA connected';<br />        if [ `echo "$XRANDR_OUT"|grep '*'|wc -l` -gt 1 ];then<br />                echo 'Turning off VGA';<br />                xrandr --output VGA --off<br />        else<br />                echo 'Turning on VGA';<br />                xrandr --output VGA --auto<br />        fi<br />else<br />        echo 'No VGA connected!';<br />fi<br /></code><br /><br />Ok now for some fun stuff with xrandr! RandR was built to rotate the screen so lets try a rotation on the second screen:<br /><code><br /># xrandr --output VGA --rotate left<br /># xrandr --output VGA --rotate right<br /># xrandr --output VGA --rotate normal<br /></code><br /><br />That last line will restore all rotations. Feeling dizzy? If not try these cool tricks:<br /><code><br /># xrandr --output VGA --reflect x<br /># xrandr --output VGA --reflect y<br /># xrandr --output VGA --reflect xy<br /># xrandr --output VGA --reflect normal<br /></code><br /><br />Finally, wouldn't it be nice to extend your desktop to two displays. Well its now possible without having special dual head monitor settings in xorg.conf and even on an intel card! (with two vga outs of course).<br /><br />There is a catch - you need to predefine the maximum combined resolution so that X server will pre-allocate that memory. Currently on intel cards, this means not enough memory for AIGLX/Compiz /3D. So I recommend creating a separate xorg.conf file for this purpose.<br /><code><br /># vi /etc/xorg.conf<br />Section "Screen"<br />        Identifier "Screen0"<br />        Monitor    "Monitor0"<br />        Device     "Card0"<br />        DefaultDepth 24<br />        <br />        SubSection "Display"<br />                Viewport   0 0<br />                Depth     24<br />                Virtual  2432 864<br />        EndSubSection<br />EndSection<br /><br /><br /># xrandr --output VGA --left-of LVDS<br /></code><br /><a href="http://www.flickr.com/photos/babytux/1430021546/" title="XRanR Dual Head"><img src="http://farm2.static.flickr.com/1269/1430021546_6417ceaa02_m.jpg" width="240" height="143" alt="xrandr dual head" /></a><br />Depending on your monitor being to the left, right, above or below of your LCD screen you should use the proper option (see man xrandr).<br /><br />Thats it for now.