---
layout: post
title: Bleeding on the Bleeding-Edge :(
date: '2006-03-17T07:34:00.000-06:00'
author: geekaholic
tags: 
modified_time: '2006-03-17T08:50:35.643-06:00'
blogger_id: tag:blogger.com,1999:blog-8947964.post-114260300741408268
blogger_orig_url: https://www.geekaholic.org/2006/03/bleeding-on-bleeding-edge.html
---

The unthinkable happened today -- My hard drive crashed! The machine stopped booting with scary looking messages I don't recall ever seeing. I looked desperately, among the randomness for a message of relief - Kernel panicked, but not even that message was to be found.<br /><br />It all started soo innocently. I updated my Xgl portage tree - just like any other morning, and went about compiling the update packages. Now my machine is known to be quite buggy and reboot, especially during disk or processor intensive tasks. Overtime I've learned to live with it, blaming it on bad hardware (after all Linux is stable right!). But the random reboots were only a mere annoyance, thanks to reiser-fs the journaled filesystem, I never met with any sort of corruption -- that is until today.<br /><h3>The gruelling path to recovery</h3><br />I booted off a <a href="http://www.taprobane.org">taprobane Livecd</a>, and went about <a href="http://foldoc.org/?fsck">fscking</a> the root partition. The exact command was:<br /><br /><code><br />reiserfsck /dev/hda3<br /></code><br /><br />After checking for over an hour, it came up with a long report that basically said, my partition was severely corrupted! It adviced me to re-run the command with the --rebuild-tree option, but the man page had some alarming text about this option:<br /><br /><cite><br />--rebuild-tree<br />              This option rebuilds the entire filesystem tree using leaf nodes<br />              found  on the device.  Normally you only need this option if the<br />              reiserfsck  --check  reports  "Running  with  --rebuild-tree  is<br />              required".  You are strongly encouraged to make a backup copy of<br />              the whole partition before attempting the --rebuild-tree option.<br />              Once  reiserfsck  --rebuild-tree  is  started it must finish its<br />              work (and you should not interrupt it), otherwise the filesystem<br />              will  be  left in the unmountable state to avoid subsequent data<br />              corruptions.<br /></cite><br /><br />So instead I decided to use the more safe --fix-fixable option which basically said to fix anything fixable. Well that wasn't enough and I did ended up running --rebuild-tree after all.<br /><br />Luckily my /home partition and the smaller /boot passed with good heath after fscking them :) All seemed well now, so I rebooted as I eagerly expected things to work. It turned out I was still far from recovery.<br /><br />At first I could see the kernel boot and load drivers. I immediately noticed now the sound driver was giving an error, but that didn't seem too important to worry bout. Then came the following message:<br /><br /><cite><br />Your system seems to be missing critical device files<br />in /dev !  Although you may be running udev or devfs,<br />the root partition is missing these required files !<br />...<br /></cite><br /><br />But I did see a login prompt, but supprisingly it never prompted me for the password! I couldn't login :(. So I rebooted again, this time with the Gentoo Xgl CD. Copied all the /dev files from the live cd onto the /dev directory on the hard drive.<br /><br />That's when I noticed the lost+found directory. I've rarely seen this directory on a reiserfs partition (its quite common on an ext[23] partition). Surprise surprise.. there were over 3-4 dozen of files that had been recovered with the inode numbers -- pretty useless without the file names. Suddenly it occurred to me -- I might have to reinstall Gentoo, something that could take a week or more. <br /><h3>Gentoo to the rescue</h3><br />I rebooted to get the same message and the same login problem. I rebooted again and chrooted into the root partiton. I first ran <em>revdep-rebuild -p</em> to check reverse dependencies but that only came up with xterm as being broken. Trying to emerge xterm revealed another problem : the gentoo package database was inconsistent, but it told me the exact command to execute.<br /><br /><code><br />/usr/lib/portage/bin/fix-db.py<br /></code><br /><br />That came up with a list of packages that came up as corrupted. So I unmerged (removed) some and re-merged others and rebooted the system. Still had no luck, so back to the livecd. Again I chrooted to the root(/) partition and started looking at the logs which revealed more kernel drivers that have failed (acpi for example). Looks like I'll need to recompile a kernel. But that still didn't explain the login problem. Looking through the log files, one revealed the problem.<br /><code><br />#tail -100 /var/log/auth.log<br /> agetty[2933]: tty1: can't exec /bin/login: No such file or directory<br /></code><br /><br />Sure enough, /bin/login was infact missing. A bit of esearching hinted pam-login was responsible for that file, so emerging it at rebooting fixed it. Phew, a sigh of relief as X-windows booted to <a href="http://www.get-e.org">enlightenment(e17)</a>.<br /><br />I still have to recompile the kernel and stay on the lookout for other (possibly) broken packages, atleast I've save on a couple of days/weeks starting from scratch!<br /><br />I guess you can't live on the bleeding edge without bleeding a little (or a lot in this case) sometimes :)