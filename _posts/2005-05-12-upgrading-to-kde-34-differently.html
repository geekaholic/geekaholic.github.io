---
layout: post
title: Upgrading to kde 3.4 -- differently
date: '2005-05-12T12:55:00.000-05:00'
author: geekaholic
tags: 
modified_time: '2005-05-12T14:25:13.830-05:00'
blogger_id: tag:blogger.com,1999:blog-8947964.post-111592534220588020
blogger_orig_url: https://www.geekaholic.org/2005/05/upgrading-to-kde-34-differently.html
---

I've been waiting to upgrade to kde 3.4 some time now, ever since it was released. <a href="http://www.kde.org">Kde</a> is one of the most popular desktop environments available on GNU/Linux mostly due innovative features being added with an overall speed improvement between releases.<br /><br />Within a matter of hours after releasing kde 3.4, it was (as one would expect) available on <a href="http://www.gentoo.org">Gentoo</a>.  But the package was masked for testing as usually the case with most new packages, before it is deemed stable with the distribution. <br /><br />So I waited and waited, <a href="http://packages.gentoo.org">checking to see</a> if it was marked as stable almost daily until..... I ran out of patience. After about a month of waiting, I finally decided it was time to make the switch after <a href="http://www.tuxmachines.org/node/308">reading a review</a> article on kde 3.4 and its new features and improvements.<br /><br />Installing something as huge as kde using sources, as the case with Gentoo, requires hours and hours of painstaking compilation.  Things get worse when there are updates to a few applications contained in a large packages that must be recompiled when ever there are such changes. To solve this Gentoo has recently started using split packages starting with the 3.4 branch. This introduces sub packages that consists of 270+ individual kde applications packaged separately and meta packages that are used to group split packages. (you can <a href="http://www.gentoo.org/doc/en/kde-split-ebuilds.xml">read more</a> on this here). This makes it easier to upgrade in the future but with a price to pay -- initial compilation takes even longer than the old method. I wanted to try the new method but didn't want to wait 20-25% longer.<br /><em><br />Reader discretion : The following content might lead to dizziness or vomit feelings due to explicit g(r)eek content. Continue reading at your own risk...<br /></em><br /><h2>Day 1: Welcome to distributed compilation</h2><br /><br />Initially I wanted to just speedup the compilation process and read that it can be done via a compiler preprocessor (cpp) cacher called <a href="http://ccache.samba.org">ccache</a>. This was good and it seemed to improve things (I didn't bother benchmarking), but I knew it was going to take a long time to compile some 270+ packages. There was another solution by the same good old people who developed ccache and <a href="http://www.samaba.org">samba</a> called distributed cc (C compiler) or in short <a href="http://distcc.samba.org">distcc</a>.<br /><br />Distcc is a neat method where you can use a couple of machines in a  compiler farm to speed up the compilation process by distributing some of the work to others. Getting distcc to work was a bit challenging in the beginning when I tried to use my desktop machine running Debian Sarge for distcc. The problem was it would compile a small part only to fail miserably stating that i686-pc-li nux-gnu-g++ was missing. This was puzzling me for a while since according to the documentation all you needed was just the same gcc compiler version on all participating nodes and nothing more. After following and failing that avenue, instead, I decided to use a friend's Gentoo box, that was running inside a Vmware session. That finally seemed to work as I felt  a fresh breath of relief. <br /><br />I couldn't complete the compilation of all the packages, since I was spending more time learning and experimenting on the technology.  I found myself coming home with another 175 packages left to compile. After getting home, I found myself with a new dilemma. Since my home machine ran a 64bit version of Gentoo, now not only did I need to use distcc but also had to do it using a cross compiler.  The cross <a href="http://dev.gentoo.org/~vapier/CROSS-COMPILE-HOWTO">compiling instructions</a> looked way too complex to try after a long day so I kept trying other things and digging the net until I came across an <a href="http://gentoo-wiki.com/TIP_AMD64-x86-distcc">article</a> written by someone who went through a similar experience. It seemed like I had to emerge a package called emul-linux-x86-compat and recompile gcc and glibc with support for multilib, but it was already too late (2:45AM) by now so instead I decided to call it a day and hit the sack.<br /><br /><h2>Day 2 : The saga continues</h2><br /><br />  I hit the jackpot with the sarge box after I followed an intutive feeling to try to create a symlink called i686-pc-linux-gnu-g++ that pointed to the g++ binary. After that worked, I created another for i686-pc-linux-gnu-gcc.  <br /><br />I spent most of the time trying to optimize the compilation process further by changing parameters. First I tried changing the order of the hosts that was participating with distcc by placing the more powerful Sarge machine  as the first entry, followed by localhost and the at last the Vmware Gentoo box. After reading the IBM's article on distcc, I decided to increase the -j option that is used to specify how many sources to compile at once.<br /><br />By the time I was leaving for home, there was only another 70 packages left. I didn't feel like spending time to fix the cross compiling issue with the 64bit barebone, so instead left the machine to compile the rest on its own and watched a movie instead. All the kde 3.4 packages had finally finished compiling and all though it still did take a long time when compared to compiling the official large kde source packages, this was mainly due to various interruptions and experimentations I did in between.<br /><br />I look forward to the next kde release, just so that I can feel good about myself for not killing time upgrading it.