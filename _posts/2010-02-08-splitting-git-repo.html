---
layout: post
title: Splitting a git repo
date: '2010-02-08T04:22:00.008-06:00'
author: geekaholic
tags:
- thinkcube
modified_time: '2012-05-15T07:04:15.604-05:00'
blogger_id: tag:blogger.com,1999:blog-8947964.post-2278191146408854377
blogger_orig_url: https://www.geekaholic.org/2010/02/splitting-git-repo.html
---

Its been almost an year since I last blogged and what can I say, micro-blogging killed blogging for me. Even micro-blogging has got to a point, I don't do  as much as I used to. Perhaps the end of web 2.0 or perhaps I'm getting too old for this :)<br /><br />Anyhow, getting back to the subject of this quick post, it seems splitting a git repo into two separate git repos is somewhat obscure and required a bit of googling around. Fortunately I came <a href="http://bytebaker.com/2009/05/18/refactoring-my-personal-git-repository">across this great blog post</a>, but wanted to summarize it in one place (the author made me look at several pages to put it together).<br /><br />Say I have a git project called foo.repo which had a subdirectory called bar, that I now want to make its own separate git project called bar.repo.<br /><br /><b>Current state</b><pre><br />foo.repo/<br />  .git/<br />   bar/<br />   abc/<br />   xyz/</pre><br /><br /><b>target state</b><pre><br />foo.repo/<br />  .git/<br />   abc/<br />   xyz/<br /><br />bar.repo/<br />  .git/<br /></pre><br /><br /><dl><br /><dt>Step 1 : Clone existing repo as desired repo on the local clone</dt><br /><dd><br /><pre><code>$ git clone --no-hardlinks foo.repo bar.repo</code></pre><br /></dd><br /><dt>Step 2: Filter-branch and reset to exclude other files, so they can be pruned:</dt><br /><dd><pre><code><br /> $ cd bar.repo<br /> $ git filter-branch --subdirectory-filter bar HEAD  -- --all<br /> $ git reset --hard<br /> $ git gc --aggressive<br /> $ git prune</code></pre><br /></dd><br /><dt>Step 3: Create new empty repo on git server</dt><br /><dd><pre><code><br /> $ mkdir /var/git/bar.git<br /> $ cd /var/git/bar.git<br /> $ git --bare init</code></pre><br /></dd><br /><br /><dt>Step 4: Back on the local machine, replace remote origin to point to new repo</dt><br /><dd><pre><code><br /> $ cd bar.repo<br /> $ git remote rm origin<br /> $ git remote add origin git@git-server:bar.repo<br /> $ git push origin master</code></pre><br /></dd><br /><dt>Step 5: Remove bar directory from original foo.repo</dt><br /><dd><pre><code><br /> $ git filter-branch --tree-filter "rm -rf bar" --prune-empty HEAD</code></pre><br />or supposed to be faster, I haven't tried<br /><pre><code>$ git filter-branch --index-filter "git rm -r -f --cached --ignore-unmatch bar" --prune-empty HEAD</code></pre><br /></dd><br /></dl><br /><br /><h2>Reference</h2><br /><ul><br /><li><a href="http://bytebaker.com/2009/05/18/refactoring-my-personal-git-repository/">Refactoring my personal git post</a></li><br /><li><a href="http://stackoverflow.com/questions/359424/detach-subdirectory-into-separate-git-repository">Detach subdirectory into separate GIT repository</a></li><br /><li><a href="http://toolmantim.com/articles/setting_up_a_new_remote_git_repository">Setting up a remote GIT repository</a></li><br /></ul>